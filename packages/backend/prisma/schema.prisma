generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// TODO: add indexes

model Game {
    checksum             String   @id @default(uuid())
    name                 String
    summary              String?
    storyline            String?
    totalRating          Float?   @map("total_rating")
    totalRatingCount     Int?     @map("total_rating_count")
    url                  String?
    firstReleaseDate     DateTime? @map("first_release_date")

    cover                Cover?
    screenshots          Screenshots[]

    gameGenres           GameGenre[]
    gameKeywords         GameKeyword[]

    gameCompanies        GameCompany[]

	personalLibraryGames PersonalLibraryGame[]

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("games")
}

model GameKeyword {
    checksum             String   @id @default(uuid())
    gameId               String   @map("game_id")
    keywordId            String   @map("keyword_id")

    game                 Game     @relation(fields: [gameId], references: [checksum])
    keyword              Keyword  @relation(fields: [keywordId], references: [checksum])

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("game_keywords")
}

model Keyword {
    checksum             String   @id @default(uuid())
    name                 String
    slug                 String
    url              String?

    gameKeywords         GameKeyword[]

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("keywords")
}

model GameCompany {
    checksum             String   @id @default(uuid())
    gameId               String   @map("game_id")
    companyId            String   @map("company_id")

    developer            Boolean
    publisher            Boolean
    supporting           Boolean

    game                 Game     @relation(fields: [gameId], references: [checksum])
    company              Company  @relation(fields: [companyId], references: [checksum])

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("game_companies")
}

model Company {
    checksum             String   @id @default(uuid())
    name                 String
    slug                 String?
    country              Int?
    startDate            DateTime? @map("start_date")

    gameCompanies        GameCompany[]

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("companies")
}

model Cover {
    checksum             String   @id @default(uuid())
    gameId               String   @unique @map("game_id")
    imageId              String   @map("image_id")
    height               Int?
    width                Int?
    url                  String?

    game                 Game     @relation(fields: [gameId], references: [checksum])

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("covers")
}

model Screenshots {
    checksum             String   @id @default(uuid())
    gameId               String   @map("game_id")
    imageId              String   @map("image_id")

    height               Int?
    width                Int?
    url                  String?

    game                 Game     @relation(fields: [gameId], references: [checksum])

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("screenshots")
}

model GameGenre {
    checksum             String   @id @default(uuid())
    gameId               String   @map("game_id")
    genreId              String   @map("genre_id")

    game                 Game     @relation(fields: [gameId], references: [checksum])
    genre                Genre    @relation(fields: [genreId], references: [checksum])

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("game_genres")
}

model Genre {
    checksum             String   @id @default(uuid())
    name                 String
    slug                 String

    gameGenres           GameGenre[]

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("genres")
}

model User {
    checksum             String   @id @default(uuid())
    email                String   @unique
    password             String

    tasteVector          Json?    @map("taste_vector") @default("{}")

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

	personalLibraries	 PersonalLibrary?

    otps                 Otp[]
    @@map("users")
}

model Otp {
    checksum             String   @id @default(uuid())
    userId               String   @map("user_id")
    code                  String
    expiresAt            DateTime

    user                 User     @relation(fields: [userId], references: [checksum])

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

    @@map("otps")
}

model PersonalLibraryGame {
    checksum             String   @id @default(uuid())
	gameId				 String   @map("game_id")
	personalLibraryId	 String   @map("personal_library_id")

	status				 EPlayStatus	  @default(BACKLOG)
	rank				 ETierRank @default(UNRANKED)

    note                 String?

	game 				 Game 	  @relation(fields: [gameId], references: [checksum])
	personalLibrary		 PersonalLibrary   @relation(fields: [personalLibraryId], references: [checksum])

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

	@@map("personal_library_games")
}

model PersonalLibrary {
    checksum             String   @id @default(uuid())
	userId				 String	  @map("user_id")   @unique

	user				 User     @relation(fields: [userId], references: [checksum])

	personalLibraryGames PersonalLibraryGame[]

    createdAt            DateTime @default(now()) @map("created_at")
    updatedAt            DateTime @updatedAt @map("updated_at")

	@@map("personal_libraries")
}

enum EPlayStatus {
    PREFERENCE
	PLAYING
	COMPLETED
	DROPPED
	ON_HOLD
	BACKLOG
}

enum ETierRank {
	S
	A
	B
	C
	D
	F
	UNRANKED
}

enum ERecommendationReason {
    ANTI_BURNOUT
    BLIND_SPOT
    HIGH_COMPATIBILITY
    BACKLOG_REMINDER
}

enum EPredictionVerdict {
    EXCELLENT
    GOOD
    RISKY
}